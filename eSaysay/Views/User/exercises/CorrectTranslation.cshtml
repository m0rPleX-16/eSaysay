@model eSaysay.Models.Entities.InteractiveExercise
@{
    ViewData["Title"] = "Correct Translation";
    ViewData["PageClass"] = "CorrectTranslation-Page";
}

<div class="container correct-exercise">
    <div class="header-correct">
        <a asp-controller="Dashboard" asp-action="LessonDetails" asp-route-id="@Model.LessonID" class="btn close-button-correct">✖</a>
        <div class="progress-bar"><div class="progress-bar-inner"></div></div>
    </div>

    <div class="title title-question">Select the correct translation</div>
    <center><div class="container correct-content"><h6>@Model.ContentTranslate</h6></div></center>

    <!-- Dynamic Answer Grid -->
    <div class="container answer-grid" id="answer-grid">
        @if (!string.IsNullOrEmpty(Model.AnswerChoices))
        {
            var choices = Model.AnswerChoices.Split(',').Select(c => c.Trim()).ToList();
            for (int i = 0; i < choices.Count; i++)
            {
                <button onclick="selectAnswer(@(i + 1))">@choices[i]</button>
            }
        }
        else
        {
            <p>No answer choices available.</p>
        }
    </div>

    <div class="footer">
        <button class="skip" onclick="skip()">Skip</button>
        <button class="check" onclick="checkAnswer()">Check</button>
    </div>
</div>

<script>
    function checkCorrectTranslationAnswer() {
        const selectedAnswer = sessionStorage.getItem('selectedAnswer');

        if (!selectedAnswer) {
            alert('Please select an answer first!');
            return;
        }

        const correctAnswer = "@Model.CorrectAnswer";
        const isCorrect = selectedAnswer.toLowerCase() === correctAnswer.toLowerCase();

        fetch('/Exercise/SaveUserResponse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                userID: "@User.Identity.Name",
                exerciseID: @Model.ExerciseID,
                userAnswer: selectedAnswer,
                isCorrect: isCorrect
            })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            if (data.isCorrect) {
                updateUserProgress();
            }
        })
        .catch(error => console.error("Error saving response:", error));
    }

</script>